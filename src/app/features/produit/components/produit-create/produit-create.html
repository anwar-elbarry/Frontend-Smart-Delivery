<div class="fixed inset-0 z-50 overflow-y-auto" (click)="closeCreateModal()">
  <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
    <!-- Modal -->
    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full"
         (click)="$event.stopPropagation()">
      <div class="bg-white">
        <!-- Header -->
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-8 py-6">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-2xl font-bold text-white flex items-center">
                <i class="fa-solid fa-cube mr-3"></i>
                {{ isEditMode() ? 'Modifier le Produit' : 'Créer un Nouveau Produit' }}
              </h2>
              <p class="text-indigo-100 mt-2">
                {{ isEditMode() ? 'Mettre à jour les informations du produit' : 'Ajouter un produit au catalogue' }}
              </p>
            </div>
            <button (click)="closeCreateModal()" class="text-white hover:text-indigo-100 transition">
              <i class="fa-solid fa-times text-2xl"></i>
            </button>
          </div>
        </div>

        <!-- Error Message -->
        @if (errorMessage()) {
          <div class="mx-8 mt-6 bg-red-50 border border-red-200 rounded-lg p-4">
            <div class="flex">
              <i class="fa-solid fa-exclamation-triangle text-red-600 mt-1"></i>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-red-800">{{ errorMessage() }}</h3>
              </div>
            </div>
          </div>
        }

        <!-- Success Message -->
        @if (successMessage()) {
          <div class="mx-8 mt-6 bg-green-50 border border-green-200 rounded-lg p-4">
            <div class="flex">
              <i class="fa-solid fa-check-circle text-green-600 mt-1"></i>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-green-800">{{ successMessage() }}</h3>
              </div>
            </div>
          </div>
        }

        <!-- Form -->
        <form class="px-8 py-6 space-y-6" (ngSubmit)="submitForm()">
          <!-- Nom du Produit -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              <i class="fa-solid fa-tag text-indigo-600 mr-2"></i>
              Nom du Produit
              <span class="text-red-500 ml-1">*</span>
            </label>
            <input
              type="text"
              name="nom"
              [(ngModel)]="formData.nom"
              placeholder="Ex: Ordinateur Portable Dell XPS 15"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
              required>
            <p class="mt-1 text-xs text-gray-500">
              <i class="fa-solid fa-info-circle mr-1"></i>
              Saisissez un nom descriptif pour le produit
            </p>
          </div>

          <!-- Catégorie et Poids -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Catégorie -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fa-solid fa-layer-group text-indigo-600 mr-2"></i>
                Catégorie
                <span class="text-red-500 ml-1">*</span>
              </label>
              <select
                name="categorie"
                [(ngModel)]="formData.categorie"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                required>
                <option value="" disabled>Sélectionner une catégorie</option>
                @for (cat of categories; track cat) {
                  <option [value]="cat">{{ cat }}</option>
                }
              </select>
            </div>

            <!-- Poids -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fa-solid fa-weight-hanging text-indigo-600 mr-2"></i>
                Poids (kg)
                <span class="text-red-500 ml-1">*</span>
              </label>
              <div class="relative">
                <input
                  type="number"
                  name="poids"
                  [(ngModel)]="formData.poids"
                  step="0.01"
                  min="0"
                  placeholder="Ex: 2.5"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                  required>
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                  <span class="text-gray-500 text-sm font-medium">kg</span>
                </div>
              </div>
              <p class="mt-1 text-xs text-gray-500">
                <i class="fa-solid fa-info-circle mr-1"></i>
                Poids en kilogrammes (ex: 0.5 pour 500g)
              </p>
            </div>
          </div>

          <!-- Prix -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              <i class="fa-solid fa-money-bill-wave text-indigo-600 mr-2"></i>
              Prix (DH)
              <span class="text-red-500 ml-1">*</span>
            </label>
            <div class="relative">
              <input
                type="number"
                name="prix"
                [(ngModel)]="formData.prix"
                step="0.01"
                min="0"
                placeholder="Ex: 1500.00"
                class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                required>
              <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
                <span class="text-gray-500 text-sm font-semibold">DH</span>
              </div>
            </div>
            <p class="mt-1 text-xs text-gray-500">
              <i class="fa-solid fa-info-circle mr-1"></i>
              Prix de vente en Dirhams marocains
            </p>
          </div>

          <!-- Preview Card -->
          <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-lg p-6 border-2 border-indigo-200">
            <h3 class="text-sm font-semibold text-gray-700 mb-4 flex items-center">
              <i class="fa-solid fa-eye text-indigo-600 mr-2"></i>
              Aperçu du Produit
            </h3>
            <div class="bg-white rounded-lg shadow-sm p-4">
              <div class="flex items-start">
                <div class="w-16 h-16 bg-indigo-100 rounded-lg flex items-center justify-center mr-4">
                  <i class="fa-solid fa-cube text-indigo-600 text-2xl"></i>
                </div>
                <div class="flex-1">
                  <h4 class="text-lg font-bold text-gray-900">{{ formData.nom || 'Nom du Produit' }}</h4>
                  <div class="flex items-center gap-4 mt-2 text-sm text-gray-600">
                    <span class="flex items-center">
                      <i class="fa-solid fa-layer-group text-indigo-500 mr-1.5"></i>
                      {{ formData.categorie || 'Catégorie' }}
                    </span>
                    <span class="flex items-center">
                      <i class="fa-solid fa-weight-hanging text-indigo-500 mr-1.5"></i>
                      {{ formData.poids || 0 }} kg
                    </span>
                  </div>
                  <div class="mt-3 flex items-center">
                    <span class="text-2xl font-bold text-indigo-600">{{ formData.prix || 0 }} DH</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Info Box -->
          <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
            <div class="flex">
              <div class="flex-shrink-0">
                <i class="fa-solid fa-info-circle text-blue-400 text-xl"></i>
              </div>
              <div class="ml-3">
                <p class="text-sm text-blue-700">
                  <span class="font-semibold">Information:</span> Tous les champs marqués d'un astérisque (<span class="text-red-500">*</span>) sont obligatoires. Assurez-vous de remplir tous les champs requis avant de soumettre le formulaire.
                </p>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex gap-4 pt-6 border-t border-gray-200">
            <button
              type="button"
              (click)="closeCreateModal()"
              [disabled]="isLoading()"
              class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-semibold shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fa-solid fa-times mr-2"></i>
              Annuler
            </button>
            <button
              type="submit"
              [disabled]="isLoading()"
              class="flex-1 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition font-semibold shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
              @if (isLoading()) {
                <i class="fa-solid fa-spinner fa-spin mr-2"></i>
                Traitement...
              } @else {
                <i class="fa-solid {{ isEditMode() ? 'fa-save' : 'fa-plus' }} mr-2"></i>
                {{ isEditMode() ? 'Mettre à jour' : 'Créer le Produit' }}
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
